<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="my random blabbing">
<title>
golang: dynamic type in a json field - intimacy of my thoughts
</title>




<link rel="shortcut icon" href="/sam.ico">








<link rel="stylesheet" href="/css/main.min.00875da36aaf66b43dd98d02c564ffc2a307908082cf20a1c1522d719463b7e4.css" integrity="sha256-AIddo2qvZrQ92Y0CxWT/wqMHkICCzyChwVItcZRjt&#43;Q=" crossorigin="anonymous" media="screen">



 

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://zkanda.io/tn.png"/>

<meta name="twitter:title" content="golang: dynamic type in a json field"/>
<meta name="twitter:description" content="We had an experience where the type of a field change base on certain conditions. We think this is bad, but we have to support it. Here&rsquo;s how.
You&rsquo;ll have to specify the field type as an interface.
type P struct { T interface{} `json:&#34;t&#34;` } After that, you&rsquo;ll need to use switch to determine the type. In our case, we needed it as int.
var i int var p P s := `{&#34;t&#34;: &#34;3460&#34;}` // should also work with // s := `{&#34;t&#34;: 3460}` if err := json."/>

<meta property="og:title" content="golang: dynamic type in a json field" />
<meta property="og:description" content="We had an experience where the type of a field change base on certain conditions. We think this is bad, but we have to support it. Here&rsquo;s how.
You&rsquo;ll have to specify the field type as an interface.
type P struct { T interface{} `json:&#34;t&#34;` } After that, you&rsquo;ll need to use switch to determine the type. In our case, we needed it as int.
var i int var p P s := `{&#34;t&#34;: &#34;3460&#34;}` // should also work with // s := `{&#34;t&#34;: 3460}` if err := json." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zkanda.io/dev/golang-dynamic-type-in-json-field/" />
<meta property="og:image" content="https://zkanda.io/tn.png"/>
<meta property="article:published_time" content="2018-11-07T04:19:05+00:00" />
<meta property="article:modified_time" content="2018-11-07T04:19:05+00:00" /><meta property="og:site_name" content="intimacy of my thoughts" />


    

    
    
    
    <title>
        
        golang: dynamic type in a json field
        
    </title>
</head>

<body>
    <div class="wrap">
        <div class="section" id="title">golang: dynamic type in a json field</div>

        <div class="section" id="content"><p>We had an experience where the type of a field change base on certain conditions. We think this is bad, but we have to support it. Here&rsquo;s how.</p>
<p>You&rsquo;ll have to specify the field type as an interface.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">P</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">T</span> <span style="color:#66d9ef">interface</span>{} <span style="color:#e6db74">`json:&#34;t&#34;`</span>
}
</code></pre></div><p>After that, you&rsquo;ll need to use <code>switch</code> to determine the type. In our case, we needed it as int.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p</span> <span style="color:#a6e22e">P</span>

<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">`{&#34;t&#34;: &#34;3460&#34;}`</span>
<span style="color:#75715e">// should also work with
</span><span style="color:#75715e">// s := `{&#34;t&#34;: 3460}`
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">NewDecoder</span>(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Body</span>).<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">s</span>)); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorln</span>(<span style="color:#a6e22e">err</span>)
}

<span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.(<span style="color:#66d9ef">type</span>) {
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">float64</span>:
    <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> int(<span style="color:#a6e22e">t</span>)
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">string</span>:
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">t</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;t is not a number: %#v&#34;</span>, <span style="color:#a6e22e">err</span>)
    }
<span style="color:#66d9ef">default</span>:
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;t is of invalid type: %#v&#34;</span>, <span style="color:#a6e22e">t</span>)
}
</code></pre></div><p>Simple as that. Thanks again to my colleague Harmen for this solution.</p>
</div>

        
        <div class="section bottom-menu">
<hr />
<p>


    

    
        
            <a href="/posts">
                posts
            </a>
        
    
    
        
            &#183; 
            <a href="/gallery">
                gallery
            </a>
        
            &#183; 
            <a href="/about">
                who is zak?
            </a>
        
            &#183; 
            <a href="/dev">
                dev
            </a>
        
    
    &#183; 
    <a href="https://zkanda.io">
        main
    </a>

</p></div>
        

        <div class="section footer">You only live once, smile and make it count.</div>
    </div>
</body>

</html>