<!DOCTYPE html>
<html lang="en-US">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="Test Methodology  Subtest  Closures Can target subtests Can nest subtests further  Table Driven Test  Low overhead to add new test cases Make testing exhaustive scenarios simple Makes reproducing reported issues simple Do this pattern a lot Followw pattern even for single cases, if it&rsquo;s possible to grow Consider naming cases  Text fixtures.  go test sets pwd as package directory Use relative path &ldquo;test-fixtures&rdquo; directory as a place to store test data Very useful for loading config, model data, binary data, etc  Golden Files(Test Flags)  Compare complex test out to a file that has the expected result.">

<meta property="og:title" content="Advance Testing in Go" />
<meta property="og:description" content="Test Methodology  Subtest  Closures Can target subtests Can nest subtests further  Table Driven Test  Low overhead to add new test cases Make testing exhaustive scenarios simple Makes reproducing reported issues simple Do this pattern a lot Followw pattern even for single cases, if it&rsquo;s possible to grow Consider naming cases  Text fixtures.  go test sets pwd as package directory Use relative path &ldquo;test-fixtures&rdquo; directory as a place to store test data Very useful for loading config, model data, binary data, etc  Golden Files(Test Flags)  Compare complex test out to a file that has the expected result." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zkanda.github.io/code/advance-testing-in-go/" />



<meta property="article:published_time" content="2017-09-15T15:06:40&#43;08:00"/>

<meta property="article:modified_time" content="2017-09-15T15:06:40&#43;08:00"/>












<title>


     Advance Testing in Go 

</title>
<link rel="canonical" href="https://zkanda.github.io/code/advance-testing-in-go/">










<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500">



    <link rel="stylesheet" href="https://zkanda.github.io/css/reset.css">
    <link rel="stylesheet" href="https://zkanda.github.io/css/pygments.css">
    <link rel="stylesheet" href="https://zkanda.github.io/css/main.css">
    




<link rel="shortcut icon"

    href="https://zkanda.github.io/img/favicon.ico"

>








</head>


<body lang="">

<section class="header">
    <div class="container">
        <div class="content">
            
            <a href="https://zkanda.github.io/"><div class="name"></div></a>
            
            <nav>
                <ul>
                    
                        <li class="nav-code"><a href="https://zkanda.github.io/code/"><span>Code</span></a></li>
                    
                        <li class="nav-photo"><a href="https://zkanda.github.io/photo/"><span>Photo</span></a></li>
                    
                        <li class="nav-about"><a href="https://zkanda.github.io/about/"><span>About</span></a></li>
                    
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">
        

        

	

        

        

        

        

        

        

        

        

        

        
        </div>
    </div>
</section>

<section class="main">
    <div class="container">
        <div class="content">
            <div class="page-heading">

    Advance Testing in Go

</div>

            <div class="markdown">
                

<h3 id="test-methodology">Test Methodology</h3>

<ul>
<li>Subtest

<ul>
<li>Closures</li>
<li>Can target subtests</li>
<li>Can nest subtests further</li>
</ul></li>
<li>Table Driven Test

<ul>
<li>Low overhead to add new test cases</li>
<li>Make testing exhaustive scenarios simple</li>
<li>Makes reproducing reported issues simple</li>
<li>Do this pattern a lot</li>
<li>Followw pattern even for single cases, if it&rsquo;s possible to grow</li>
<li>Consider naming cases</li>
</ul></li>
<li>Text fixtures.

<ul>
<li><code>go test</code> sets pwd as package directory</li>
<li>Use relative path &ldquo;test-fixtures&rdquo; directory as a place to store test data</li>
<li>Very useful for loading config, model data, binary data, etc</li>
</ul></li>
<li>Golden Files(Test Flags)

<ul>
<li>Compare complex test out to a file that has the expected result.</li>
</ul></li>
</ul>

<h3 id="writing-testable-code">Writing Testable Code</h3>

<ul>
<li>Global State

<ul>
<li>Avoid it as much as possible</li>
</ul></li>
<li>Test Helper

<ul>
<li>Never return error</li>
<li>Used to make tests clear on what they&rsquo;re testing vs what is a boilerplate.</li>
<li>in Go 1.9, there&rsquo;s now t.Helper() for cleaner failure output.</li>
<li>Returning a func() for cleanup is an elegant way to hide that.</li>
<li>The func() is a closure that can have access to *testing.T to also fail</li>
<li>Example: testChdir proper setup/cleanup would be at least 10 lines without the helper.</li>
</ul></li>
<li>Repeat Yourself

<ul>
<li>Localized logic is more important than test lines of code.</li>
<li>When a test fails, you very often don&rsquo;t remember the details of the test. It is very cumbersome to have logic spread across multiple call sites.</li>
<li>Limit helpers to very reused logic that doesn&rsquo;t fail often(example: changing directory) or fails all at once(creating a test server).</li>
<li>Copy and paste</li>
<li>Prefer 200 line to test to a 20 line test with abstracted helpers.</li>
</ul></li>
<li>Packages/Functions

<ul>
<li>Break down functionality into packages/functions judiciously</li>
<li>Note: Don&rsquo;t overdo it. Do it where it makes sense.</li>
<li>Doing this correctly will aid testing while also improving organization. Over-doing it will complicate testing and readability.</li>
<li>Qualitative, but practice will make perfect.</li>
<li>Unless a function is <em>extremely complex</em>, we try to test only the exported functions, the exported API.</li>
<li>Treat unexported functions/structs as implementation details; they are a means to an end. As long as we test the end and it behaves within spec, the means don&rsquo;t matter.</li>
<li>Some people take this too far and choose to only integration/acceptance test, the ultimate &ldquo;test the end, ignore the means.&rdquo; We disagree with this approach.</li>
</ul></li>
<li>Internal Packages

<ul>
<li>Use internal packages to safely &ldquo;over-package&rdquo;</li>
<li>Under-packaging is very hard to refactor out in small pieces due to import cycles. You really have to do a major refactor.</li>
<li>Prefer to create too many packages(many only export a single function) and hide them under &ldquo;internal&rdquo; just in case.</li>
</ul></li>
<li>Networking

<ul>
<li>Testing networking? Make a real network connection.</li>
<li>Don&rsquo;t mock <code>net.Conn</code>, no point.</li>
</ul></li>
<li>Configurability.

<ul>
<li>Unconfigurability behavior is often a point of difficulty for tests.

<ul>
<li>Example: ports, timeouts, paths</li>
</ul></li>
<li>Over-parameterize structs to allow tests to fine-tune their behavior</li>
<li>It is okay to make these configurations unexported so only tests can set them.</li>
</ul></li>
<li>Complex Structs

<ul>
<li>Trees, Linked lists, etc. Example: Terraform graphs</li>
<li>Can use reflect.DeepEqual or 3rd party lib</li>
<li>Can sometimes produce better output and test more specific functionality with testString()</li>
<li>A bit blunt honestly but we&rsquo;ve had good results.</li>
</ul></li>
<li>Subprocess

<ul>
<li>typical point of difficult-to-test behavior</li>
<li>Two options:

<ul>
<li>Actually do the subprocess</li>
<li>Mock the output or behavior.</li>
</ul></li>
</ul></li>
<li>Interfaces

<ul>
<li>Mocking points</li>
<li>Behavior can be defined regardless of implementation and exposed via custom framework or testing.go</li>
<li>Similar to package/functions: do tihs judiciously, but overdoing it will complicate readability</li>
</ul></li>
<li>Testing as public api.</li>
</ul>

            </div>
        </div>
    </div>
</section>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-79101-12', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>







</body>
</html>

