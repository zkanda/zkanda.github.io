<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Advance Testing in Go"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@"/>



  	<meta property="og:title" content="Advance Testing in Go &middot; Realm of Space" />
  	<meta property="og:site_name" content="Realm of Space" />
  	<meta property="og:url" content="https://zkanda.github.io/advance-testing-in-go/" />

    
        
            <meta property="og:image" content="/images/coffee-screen.jpeg"/>
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2017-09-15T15:06:40&#43;08:00" />

    
    <meta property="article:tag" content="golang" />
    
    <meta property="article:tag" content="testing" />
    
    

    <title>Advance Testing in Go &middot; Realm of Space</title>

    
    <meta name="description" content="Test Methodology  Subtest  Closures Can target subtests Can nest subtests further  Table Driven Test  Low overhead to add new test cases Make testing exhaustive" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/css/nav.css" />

    

    

    
      
          <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Realm of Space" />
      
      
    
    <meta name="generator" content="Hugo 0.28" />

    <link rel="canonical" href="https://zkanda.github.io/advance-testing-in-go/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": ,
        "logo": https://zkanda.github.io/images/logo.png
    },
    "author": {
        "@type": "Person",
        "name": ,
        
        "image": {
            "@type": "ImageObject",
            "url": https://zkanda.github.io/images/logo.png,
            "width": 250,
            "height": 250
        }, 
        
        "url": http://blog.zkanda.io,
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": Advance Testing in Go,
    "name": Advance Testing in Go,
    "wordCount": 547,
    "timeRequired": "PT3M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": en
    },
    "url": https://zkanda.github.io/advance-testing-in-go/,
    "datePublished": 2017-09-15T15:06Z,
    "dateModified": 2017-09-15T15:06Z,
    
    "keywords": golang, testing,
    "description": ,
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": https://zkanda.github.io/advance-testing-in-go/
    }
}
    </script>
    


    

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Home</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
      <a class="blog-logo" href="https://zkanda.github.io/"><img src="/images/logo.png" alt="Home" /></a>
  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Advance Testing in Go</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2017-09-15T15:06:40&#43;08:00">
            Sep 15, 2017
          </time>
        
         
          <span class="post-tag small"><a href="https://zkanda.github.io//tags/golang/">#golang</a></span>
         
          <span class="post-tag small"><a href="https://zkanda.github.io//tags/testing/">#testing</a></span>
         
        </section>
    </header>

    <section class="post-content">
      

<h3 id="test-methodology">Test Methodology</h3>

<ul>
<li>Subtest

<ul>
<li>Closures</li>
<li>Can target subtests</li>
<li>Can nest subtests further</li>
</ul></li>
<li>Table Driven Test

<ul>
<li>Low overhead to add new test cases</li>
<li>Make testing exhaustive scenarios simple</li>
<li>Makes reproducing reported issues simple</li>
<li>Do this pattern a lot</li>
<li>Followw pattern even for single cases, if it&rsquo;s possible to grow</li>
<li>Consider naming cases</li>
</ul></li>
<li>Text fixtures.

<ul>
<li><code>go test</code> sets pwd as package directory</li>
<li>Use relative path &ldquo;test-fixtures&rdquo; directory as a place to store test data</li>
<li>Very useful for loading config, model data, binary data, etc</li>
</ul></li>
<li>Golden Files(Test Flags)

<ul>
<li>Compare complex test out to a file that has the expected result.</li>
</ul></li>
</ul>

<h3 id="writing-testable-code">Writing Testable Code</h3>

<ul>
<li>Global State

<ul>
<li>Avoid it as much as possible</li>
</ul></li>
<li>Test Helper

<ul>
<li>Never return error</li>
<li>Used to make tests clear on what they&rsquo;re testing vs what is a boilerplate.</li>
<li>in Go 1.9, there&rsquo;s now t.Helper() for cleaner failure output.</li>
<li>Returning a func() for cleanup is an elegant way to hide that.</li>
<li>The func() is a closure that can have access to *testing.T to also fail</li>
<li>Example: testChdir proper setup/cleanup would be at least 10 lines without the helper.</li>
</ul></li>
<li>Repeat Yourself

<ul>
<li>Localized logic is more important than test lines of code.</li>
<li>When a test fails, you very often don&rsquo;t remember the details of the test. It is very cumbersome to have logic spread across multiple call sites.</li>
<li>Limit helpers to very reused logic that doesn&rsquo;t fail often(example: changing directory) or fails all at once(creating a test server).</li>
<li>Copy and paste</li>
<li>Prefer 200 line to test to a 20 line test with abstracted helpers.</li>
</ul></li>
<li>Packages/Functions

<ul>
<li>Break down functionality into packages/functions judiciously</li>
<li>Note: Don&rsquo;t overdo it. Do it where it makes sense.</li>
<li>Doing this correctly will aid testing while also improving organization. Over-doing it will complicate testing and readability.</li>
<li>Qualitative, but practice will make perfect.</li>
<li>Unless a function is <em>extremely complex</em>, we try to test only the exported functions, the exported API.</li>
<li>Treat unexported functions/structs as implementation details; they are a means to an end. As long as we test the end and it behaves within spec, the means don&rsquo;t matter.</li>
<li>Some people take this too far and choose to only integration/acceptance test, the ultimate &ldquo;test the end, ignore the means.&rdquo; We disagree with this approach.</li>
</ul></li>
<li>Internal Packages

<ul>
<li>Use internal packages to safely &ldquo;over-package&rdquo;</li>
<li>Under-packaging is very hard to refactor out in small pieces due to import cycles. You really have to do a major refactor.</li>
<li>Prefer to create too many packages(many only export a single function) and hide them under &ldquo;internal&rdquo; just in case.</li>
</ul></li>
<li>Networking

<ul>
<li>Testing networking? Make a real network connection.</li>
<li>Don&rsquo;t mock <code>net.Conn</code>, no point.</li>
</ul></li>
<li>Configurability.

<ul>
<li>Unconfigurability behavior is often a point of difficulty for tests.

<ul>
<li>Example: ports, timeouts, paths</li>
</ul></li>
<li>Over-parameterize structs to allow tests to fine-tune their behavior</li>
<li>It is okay to make these configurations unexported so only tests can set them.</li>
</ul></li>
<li>Complex Structs

<ul>
<li>Trees, Linked lists, etc. Example: Terraform graphs</li>
<li>Can use reflect.DeepEqual or 3rd party lib</li>
<li>Can sometimes produce better output and test more specific functionality with testString()</li>
<li>A bit blunt honestly but we&rsquo;ve had good results.</li>
</ul></li>
<li>Subprocess

<ul>
<li>typical point of difficult-to-test behavior</li>
<li>Two options:

<ul>
<li>Actually do the subprocess</li>
<li>Mock the output or behavior.</li>
</ul></li>
</ul></li>
<li>Interfaces

<ul>
<li>Mocking points</li>
<li>Behavior can be defined regardless of implementation and exposed via custom framework or testing.go</li>
<li>Similar to package/functions: do tihs judiciously, but overdoing it will complicate readability</li>
</ul></li>
<li>Testing as public api.</li>
</ul>

    </section>


  <footer class="post-footer">


    








<figure class="author-image">
    <a class="img" href="https://zkanda.github.io/" style="background-image: url(/images/logo.png)"><span class="hidden">Zakatell Kanda's Picture</span></a>
</figure>


<section class="author">
  <h4><a href="https://zkanda.github.io/">Zakatell Kanda</a></h4>
  
  <p>Read <a href="https://zkanda.github.io/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    
    <span class="author-link icon-link"><a href="http://blog.zkanda.io">http://blog.zkanda.io</a></span>
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Advance%20Testing%20in%20Go&nbsp;-&nbsp;Realm%20of%20Space&amp;url=https%3a%2f%2fzkanda.github.io%2fadvance-testing-in-go%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fzkanda.github.io%2fadvance-testing-in-go%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fzkanda.github.io%2fadvance-testing-in-go%2f&amp;description=Advance%20Testing%20in%20Go"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fzkanda.github.io%2fadvance-testing-in-go%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    







  </footer>
</article>

</main>


  <aside class="read-next">
  
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Realm of Space</a> All rights reserved</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    
</body>
</html>

